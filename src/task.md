
## Task 1

1.1.

1) адрес сети 192.167.38.54/13 - 192.160.0.0/13

![ipcalc 192.167.38.54/13](./images/Task.1.1.png)

2) перевод маски 255.255.255.0 в префиксную запись = /24 
\
перевод маски 255.255.255.0 в двоичную запись = 11111111.11111111.11111111.00000000

![ipcalc 255.255.255.0](./images/Task.1.2.png)

\
перевод /15 в обычную запись = 255.254.0.0 
\
перевод /15 в двоичную запись = 11111111.11111110.00000000.00000000

![ipcalc 0.0.0.0/15](./images/Task.1.3.png)

\
перевод 11111111.11111111.11111111.11110000 в обычную запись = 255.255.255.240
\
перевод 11111111.11111111.11111111.11110000 в префиксную запись = /28

![ipcalc 0.0.0.0/28](./images/Task.1.4.png)

3)  в сети 12.167.38.4/8 минимальный хост = 12.0.0.1 и максимальный хост = 12.255.255.254

![ipcalc 12.167.38.4/8](./images/Task.1.5.png)

в сети 12.167.38.4/16 минимальный хост = 12.167.0.1 и максимальный хост = 12.167.255.254

![ipcalc 12.167.38.4/16](./images/Task.1.6.png)

в сети 12.167.38.4/23 минимальный хост = 12.167.38.1 и максимальный хост = 12.167.39.254

![ipcalc 12.167.38.4/23](./images/Task.1.7.png)

в сети 12.167.38.4/4 минимальный хост = 0.0.0.1 и максимальный хост = 15.255.255.254

![ipcalc 12.167.38.4/23](./images/Task.1.8.png)

1.2. 
Диапазон localhost: 127.0.0.1 - 127.255.255.254
\
По адресам 127.0.0.2, 127.1.0.1 -  можно обратиться


1.3. Диапазоны и сегменты сетей

1) Частные: 10.0.0.45, 192.168.4.2, 10.10.10.10, 172.20.250.4, 172.16.255.255
\
Публичные: 134.43.0.2, 172.0.2.1, 192.172.0.1, 172.68.0.2, 192.169.168.1

2)  IP адреса шлюза возможные у сети 10.10.0.0/18 - 10.10.0.2, 10.10.10.10, 10.10.1.255


## Task 2

2.0.

Изменение etc/netplan/00-installer-config.yaml для ws1

![изменение для ws1 yaml файла](./images/Task2.1.png)

Изменение etc/netplan/00-installer-config.yaml для ws2

![изменение для ws2 yaml файла](./images/Task2.2.png)

2.1.

Добавление статического маршрута для ws1

![команда для добавления стат машрута](./images/Task2.3.png)

Добавление статического маршрута для ws2

![команда для добавления стат машрута](./images/Task2.4.png)

ping с машины ws1 на ws2

![ping c ws1 на ws2](./images/Task2.5.png)

ping с машины ws2 на ws1

![ping c ws2 на ws1](./images/Task2.6.png)


2.2.

Добавлен статический маршрут с ws1 на ws2

![файл yaml](./images/Task2.7.png)

Добавлен статический маршрут с ws2 на ws1

![файл yaml](./images/Task2.8.png)

ping с машины ws1 на ws2

![ping c ws1 на ws2](./images/Task2.9.png)

ping с машины ws2 на ws1

![ping c ws2 на ws1](./images/Task2.10.png)

## Task 3

3.1.

Перевод записи: \
8 Mbps = 1 MB/s \
100 MB/s = 819200 Kbps \
1 Gbps = 1024 Mbps

3.2.

Измерение скорости соединения ws1 с ws2 при помощи утилиты iperf3

Для этого сделаем ws1 сервером (порт оставим стандартный 5201, а также укажем формат вывода для скорости соединения). Делается следующей командой на машине ws1: iperf -s -f K

На ws2 необходимо ввести команду iperf3 -c 192.168.100.10 -f K

![ws1](./images/Task3.1.png)

![ws2](./images/Task3.2.png)

## Task 4

4.1. 

Настройка firewall.sh на магине ws1 

![firewall ws1](./images/Task4.1.png)

Настройка firewall.sh на магине ws2

![firewall ws2](./images/Task4.2.png)

Запуск скриптов 

ws1:

![ws1 запуск firewall.sh](./images/Task4.3.png)

ws2:

![ws2 запуск firewall.sh](./images/Task4.4.png)

Разница в последовательности. Правила,находящиеся выше по цепочке более приоритетны и исполняются в первую очередь

4.2.

ping на ws1

![ping ws2 с ws1](./images/Task4.5.png)

ping на ws2

![ping ws1 с ws2](./images/Task4.6.png)

nmap на ws1

![nmap с ws1 на ws2](./images/Task4.7.png)

## Task 5

5.1.

Настройка адресов машин: 

ws11

![ws11 netplan](./images/Task5.1.png)

![ws11 ip -4 a](./images/Task5.2.png)

ws21

![ws21 netplan](./images/Task5.3.png)

![ws21 ip -4 a](./images/Task5.4.png)

ws22

![ws22 netplan](./images/Task5.5.png)

![ws22 ip -4 a](./images/Task5.6.png)

r1

![r1 netplan](./images/Task5.7.png)

![r1 ip -4 a](./images/Task5.8.png)

r2

![r2 netplan](./images/Task5.9.png)

![r2 ip -4 a](./images/Task5.10.png)

ping ws22 на ws21

![ping ws22](./images/Task5.3.1.png)

ping r1 на ws11

![ping r1](./images/Task5.1.1.png)

5.2.

использование sysctl -w net.ipv4.ip_forward=1 на r1 и r2

r1

![r1 ip_forward](./images/Task5.11.png)

r2

![r2 ip_forward](./images/Task5.12.png)

изменение /etc/sysctl.conf

r1

![r1 ip_forward](./images/Task5.13.png)

r2

![r2 ip_forward](./images/Task5.14.png)

5.3.

Вывод .ymal файла с настроенными маршрутами по умолчанию

ws11

![ws11 .ymal file](./images/Task5.17.png)

ws21 \
![ws21 .ymal file](./images/Task5.15.png)

ws22

![ws22 .ymal file](./images/Task5.19.png)

Вывод ip r

ws11

![ws11 ip r](./images/Task5.18.png)

ws21

![ws21 ip r](./images/Task5.16.png)

ws22

![ws22 ip r](./images/Task5.20.png)

пиг r2 с ws11 

ws11

![ping r2](./images/Task5.21.png)

r2

![r2 tcpdump -tn -i enp0s8](./images/Task5.22.png)

5.4.

добалвены в r1 и r2 стат маршруты в фале конфигурации

r1

![r1 .yaml fail](./images/Task5.23.png)

r2

![r2 .yaml fail](./images/Task5.25.png)

вызов ip r для r1 и r2

r1

![r1 ip r](./images/Task5.24.png)

r2

![r2 ip r](./images/Task5.26.png)

команда ip r list 10.10.0.0/18 и ip r list 0.0.0.0/0

![вызов команд](./images/Task5.27.png)

Для адреса 10.10.0.0/18 был выбран маршрут, отличный от 0.0.0.0/0, так как маршрут по умолчанию имеет меньшую приоритетность.

5.5.

При помощи утилиты traceroute построить список маршрутизаторов на пути от ws11 до ws21

![r1](./images/Task5.28.png)

![ws11](./images/Task5.29.png)

Для определения промежуточных маршрутизаторов traceroute отправляет серию пакетов данных целевому узлу, при этом каждый раз увеличивая на 1 значение поля TTL («время жизни»). Это поле обычно указывает максимальное количество маршрутизаторов, которое может быть пройдено пакетом. Первый пакет отправляется с TTL, равным 1, и поэтому первый же маршрутизатор возвращает обратно сообщение ICMP, указывающее на невозможность доставки данных. Traceroute фиксирует адрес маршрутизатора, а также время между отправкой пакета и получением ответа (эти сведения выводятся на монитор компьютера). Затем traceroute повторяет отправку пакета, но уже с TTL, равным 2, что позволяет первому маршрутизатору пропустить пакет дальше.

Процесс повторяется до тех пор, пока при определённом значении TTL пакет не достигнет целевого узла. При получении ответа от этого узла процесс трассировки считается завершённым.

5.6.

Запустить на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды:
tcpdump -n -i eth0 icm. 
Пропинговать с ws11 несуществующий IP (например, 10.30.0.111) с помощью команды:
ping -c 1 10.30.0.111

![r1](./images/Task5.30.png)

![ws11](./images/Task5.31.png)

## Task 6

Предже чем настраивать DHCP сервер необходимо его установить на r2 командой sudo apt install isc-dhcp-server. После необходимо его включить, указав сетевой интерфейс для работы. Для этого нужно изменить файл /etc/default/isc-dhcp-server

![isc-dhcp-server](./images/Task6.1.png)

настройка DHCP сервера на r2 в файле /etc/dhcp/dhcpd.conf

![dhcpd.conf](./images/Task6.2.png)

Изменение файла /etc/resolv.conf

![resolv.conf](./images/Task6.3.png)

Чтобы DHCP сервер выдал IP адрес ws21, необходимо изменить .ymal файл и установить автаматическое присвоение ipv4 адреса 

![файл ymal](./images/Task6.4.png)

Теперь мы видим, что наш настроеный DHCP сервер на r2 присвоил IP адрес ws21 из выделенного диапазона. И мы можем пропинговать машину ws22

![ip ws21](./images/Task6.5.png)

Теперь необходимо сделать это такую же настройку для r1 и ws11 за исключением того, что IP адрес будет присваиваться исходя из mac адреса устройства. Для этого меняем ymal файл на ws11. (чтобы все работало пришлось также выставить в VB нужный мак адрес)

![ip ws11](./images/Task6.6.png)

Снова меняем файл /etc/default/isc-dhcp-server , но на r1

![isc-dhcp-server](./images/Task6.7.png)

Настройка DHCP сервера на r1 в файле /etc/dhcp/dhcpd.conf

![dhcpd.conf](./images/Task6.8.png)

Изменение файла /etc/resolv.conf

![resolv.conf](./images/Task6.9.png)

Проверяем, что IP выданый DHCP для ws11 совпадает с определенным нами списком выделенных адресов

![resolv.conf](./images/Task6.10.png)

## Task 7

В файле /etc/apache2/ports.conf на ws22 и r1 изменить строку Listen 80 на Listen 0.0.0.0:80, то есть сделать сервер Apache2 общедоступным

![/etc/apache2/ports.conf](./images/Task7.1.png)

Запустить веб-сервер Apache командой service apache2 start на ws22 и r1

r1

![service apache2 start](./images/Task7.2.png) 

ws22

![service apache2 start](./images/Task7.3.png) 

Добавить в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:

1) удаление правил в таблице filter - iptables -F


2) удаление правил в таблице "NAT" - iptables -F -t nat


3) отбрасывать все маршрутизируемые пакеты - iptables --policy FORWARD DROP

![/etc/firewall.sh](./images/Task7.4.png)

![chmod](./images/Task7.5.png)

Проверить соединение между ws22 и r1 командой ping

![ping](./images/Task7.6.png)

Добавить в файл ещё одно правило:

4) разрешить маршрутизацию всех пакетов протокола ICMP

![/etc/firewall.sh](./images/Task7.7.png)

Проверить соединение между ws22 и r1 командой ping

При запуске файла с этими правилами, ws22 должна "пинговаться" с r1

![ping](./images/Task7.8.png)

Добавить в файл ещё два правила:

5) включить SNAT, а именно маскирование всех локальных ip из локальной сети, находящейся за r2 (по обозначениям из Части 5 - сеть 10.20.0.0)
Совет: стоит подумать о маршрутизации внутренних пакетов, а также внешних пакетов с установленным соединением

6) включить DNAT на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети
Совет: стоит учесть, что при попытке подключения возникнет новое tcp-соединение, предназначенное ws22 и 80 порту

![/etc/firewall.sh](./images/Task7.10.png)

роверить соединение по TCP для SNAT, для этого с ws22 подключиться к серверу Apache на r1 командой:
telnet [адрес] [порт]

![telnet](./images/Task7.11.png)

Проверить соединение по TCP для DNAT, для этого с r1 подключиться к серверу Apache на ws22 командой telnet (обращаться по адресу r2 и порту 8080)

![telnet](./images/Task7.12.png)

## Task 8 

Запустить веб-сервер Apache на ws22 только на localhost (то есть в файле /etc/apache2/ports.conf изменить строку Listen 80 на Listen localhost:80)

![/etc/apache2/ports.conf](./images/Task8.1.png)

Воспользоваться Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21

![подключение по LTF](./images/Task8.2.png)

Воспользоваться Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11

![подключение по RTF](./images/Task8.3.png)

Для проверки, сработало ли подключение в обоих предыдущих пунктах, перейдите во второй терминал (например, клавишами Alt + F2) и выполните команду:
telnet 127.0.0.1 [локальный порт]

![telnet](./images/Task8.4.png)

![telnet](./images/Task8.5.png)